<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Animasi Shock Wave Ledakan ke Bangunan (Auto Rewind)</title>
  <style>
    body { background: #f8fafc; margin: 0; padding: 0; }
    #scene {
      position: relative; width: 900px; height: 340px; margin: 40px auto 20px auto; background: #e5e7eb; border-radius: 14px; overflow: hidden;
      box-shadow: 0 2px 20px #0002;
    }
    .building { position: absolute; bottom: 45px; border-radius: 5px; box-shadow: 0 2px 8px #0003; transition: all 0.7s cubic-bezier(.85,-0.05,.43,1.09);}
    .building.small   { left: 350px; width: 40px; height: 50px; background: #38bdf8; }
    .building.medium  { left: 490px; width: 50px; height: 85px; background: #2563eb; }
    .building.tall    { left: 670px; width: 55px; height: 145px; background: #0f172a; }
    .window { position: absolute; background: #fff; border-radius: 2px; border: 1px solid #b4b4b4; transition: background 0.7s, opacity 0.7s, border-color 0.7s; }
    #explosion {
      position: absolute; left: 110px; bottom: 65px; width: 40px; height: 40px; z-index: 10;
      background: radial-gradient(circle at 55% 60%, #ffd600 35%, #ff7300 70%, transparent 90%);
      border-radius: 50%; box-shadow: 0 0 50px 10px #ffbf00aa;
      border: 3px dashed #ffa500;
      animation: pulse 1.1s infinite linear;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 30px 5px #ffe066aa;}
      100% { box-shadow: 0 0 60px 20px #ffe06600;}
    }
    #ground {
      position: absolute; left: 0; bottom: 0; width: 100%; height: 70px;
      background: linear-gradient(#b45309 60%, #fde68a 90%);
      border-radius: 0 0 90px 60px / 0 0 80px 50px;
      z-index: 0;
    }
    .wave {
      position: absolute; left: 125px; bottom: 85px; z-index: 2;
      border: 0px solid transparent;
      border-radius: 50%;
      background: radial-gradient(circle, #ffa60099 0%, #ff1744bb 60%, #6d28d9aa 95%, transparent 100%);
      pointer-events: none;
      opacity: 0.83;
      animation: waveGrow 3.4s cubic-bezier(.72,-0.03,.39,1.13) forwards;
    }
    @keyframes waveGrow {
      0% { width: 40px; height: 40px; margin-left: -20px; margin-bottom: -20px; opacity:0.85;}
      10% { opacity: 0.96;}
      60% { opacity: 0.65;}
      90% { opacity:0.22;}
      100% { width: 900px; height: 900px; margin-left: -450px; margin-bottom: -450px; opacity:0;}
    }
    .destroy50 { height: 25px !important; background: linear-gradient(#ef4444 75%, #fff 100%)!important; margin-top: 25px !important; opacity: 0.7;}
    .destroy80 { height: 15px !important; background: linear-gradient(#b91c1c 85%, #fff 100%)!important; margin-top: 70px !important; opacity: 0.4;}
    .cracked { background: repeating-linear-gradient(-45deg, #d1d5db 0px, #d1d5db 3px, #fff 3px, #fff 8px) !important; }
    .window.broken { background: #bdbdbd !important; opacity: 0.22; border-color: #a855f7;}
    .window.framebroken { border-color: #b91c1c !important;}
    .hit { animation: shake 0.6s; }
    @keyframes shake {
      0% { transform: translateX(0);}
      20% { transform: translateX(-7px);}
      40% { transform: translateX(9px);}
      60% { transform: translateX(-5px);}
      80% { transform: translateX(5px);}
      100% { transform: translateX(0);}
    }
    .effect-label {
      position: absolute; left: 0; right:0; bottom: 100%; text-align:center; font-size:1.08em; color:#b91c1c;
      background: #fff3; border-radius: 7px; padding: 3px 0 1px 0;
      opacity: 0; transition: opacity 0.7s;
      pointer-events: none;
      font-weight: 600;
    }
    .show-label { opacity: 1; }
  </style>
</head>
<body>
  <h2 style="text-align:center; font-family:sans-serif; color:#0f172a;">Animasi Ledakan & Shock Wave ke Bangunan (Auto Rewind)</h2>
  <div id="scene">
    <div id="explosion"></div>
    <div id="ground"></div>
    <div class="building small" id="bSmall"><div class="effect-label" id="lSmall"></div></div>
    <div class="building medium" id="bMedium"><div class="effect-label" id="lMedium"></div></div>
    <div class="building tall" id="bTall"><div class="effect-label" id="lTall"></div></div>
  </div>
  <div style="text-align:center; margin-top:20px;">
    <button onclick="startBlast()" id="startBtn" style="padding:8px 22px;font-size:1em; border-radius:6px;">▶️ Mulai Ledakan</button>
    <button onclick="resetScene(true)" style="padding:8px 22px;font-size:1em; border-radius:6px;">⏹️ Reset</button>
    <div style="margin-top:12px; font-size:1.1em;" id="caption">Klik "Mulai Ledakan" untuk melihat efek gelombang ke bangunan.<br>Auto rewind aktif!</div>
  </div>
  <script>
    // Helper tambah window
    function addWindows(buildingId, nRows, nCols, size) {
      const b = document.getElementById(buildingId);
      Array.from(b.children).forEach(child => { if (!child.classList.contains("effect-label")) child.remove(); });
      let windows = [];
      for (let r = 0; r < nRows; r++) {
        for (let c = 0; c < nCols; c++) {
          let w = document.createElement('div');
          w.className = 'window';
          w.style.width = size+'px';
          w.style.height = size+'px';
          w.style.left = (5 + c*(size+4)) + 'px';
          w.style.bottom = (6 + r*(size+7)) + 'px';
          w.dataset.row = r;
          windows.push(w);
          b.appendChild(w);
        }
      }
      return windows;
    }
    addWindows('bSmall', 2, 2, 10);
    addWindows('bMedium', 3, 3, 11);
    addWindows('bTall', 10, 3, 11);

    // ANIMASI SHOCK WAVE + AUTO REWIND
    let waveElem = null;
    let autoLoop = false;
    let timers = [];

    function startBlast() {
      autoLoop = true;
      document.getElementById('startBtn').disabled = true;
      blastSequence();
    }

    function blastSequence() {
      resetScene(false); // reset tanpa matikan autoLoop
      document.getElementById('caption').innerHTML = "Shock wave merambat & menghancurkan bangunan satu per satu...<br>Auto rewind aktif!";
      // Buat shockwave animasi lingkaran besar (melewati semua)
      waveElem = document.createElement('div');
      waveElem.className = 'wave';
      document.getElementById('scene').appendChild(waveElem);

      // Bangunan kecil (kena duluan)
      timers.push(setTimeout(() => {
        let b = document.getElementById('bSmall');
        b.classList.add('hit', 'destroy50');
        showLabel('lSmall', "50% Kerusakan Struktur");
      }, 700));

      // Bangunan sedang (kerusakan 80%)
      timers.push(setTimeout(() => {
        let b = document.getElementById('bMedium');
        b.classList.add('hit', 'destroy80');
        showLabel('lMedium', "80% Kerusakan Struktur");
      }, 1600));

      // Bangunan tinggi (20 jendela paling atas pecah & frame rusak)
      timers.push(setTimeout(() => {
        let b = document.getElementById('bTall');
        b.classList.add('hit');
        pecahkanKacaTinggi();
        showLabel('lTall', "Kerusakan Kaca & Frame Atas");
      }, 2300));

      // Hapus shockwave dan auto rewind
      timers.push(setTimeout(() => {
        if (waveElem) waveElem.remove();
      }, 3400));

      // Auto rewind (ulang animasi)
      timers.push(setTimeout(() => {
        if(autoLoop) blastSequence();
      }, 4100));
    }

    function showLabel(id, text) {
      let l = document.getElementById(id);
      l.textContent = text;
      l.classList.add('show-label');
      timers.push(setTimeout(() => l.classList.remove('show-label'), 2100));
    }

    // Efek pecah kaca bangunan tinggi (20 jendela paling atas)
    function pecahkanKacaTinggi() {
      let b = document.getElementById('bTall');
      let win = Array.from(b.querySelectorAll('.window'));
      let nRows = 10;
      let nCols = 3;
      let nWinCrack = 20;
      let cracked = 0;
      for (let r = nRows-1; r >=0; r--) {
        for (let c = 0; c < nCols; c++) {
          if (cracked < nWinCrack) {
            let idx = r*nCols + c;
            win[idx].classList.add('broken','cracked','framebroken');
            cracked++;
          }
        }
      }
    }

    function resetScene(full=true) {
      if (waveElem) { waveElem.remove(); waveElem = null;}
      document.getElementById('caption').innerHTML = "Klik \"Mulai Ledakan\" untuk melihat efek gelombang ke bangunan.<br>Auto rewind aktif!";
      // Reset bangunan
      let bSmall = document.getElementById('bSmall');
      bSmall.className = 'building small';
      let bMedium = document.getElementById('bMedium');
      bMedium.className = 'building medium';
      let bTall = document.getElementById('bTall');
      bTall.className = 'building tall';
      // Reset label
      ['lSmall','lMedium','lTall'].forEach(id=>{
        let l = document.getElementById(id);
        l.textContent = ""; l.className = "effect-label";
      });
      // Reset windows
      addWindows('bSmall', 2, 2, 10);
      addWindows('bMedium', 3, 3, 11);
      addWindows('bTall', 10, 3, 11);
      // Bersihkan timer
      for(let t of timers) clearTimeout(t);
      timers = [];
      // Stop auto loop jika benar-benar reset
      if(full) {
        autoLoop = false;
        document.getElementById('startBtn').disabled = false;
      }
    }
  </script>
</body>
</html>
